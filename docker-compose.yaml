services:
  garageunderground:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: garageunderground
    restart: unless-stopped
    ports:
      - "8080:8080"
    volumes:
      # Mount volume for database persistence
      - garageunderground-data:/data
      # Mount volume for ASP.NET Data Protection keys
      - garageunderground-keys:/root/.aspnet/DataProtection-Keys
    environment:
      # Override appsettings.json values using environment variables
      # Database configuration
      - LiteDb__ConnectionString=Filename=/data/garageunderground.db;Connection=shared
      
      # Microsoft Entra ID authentication (optional)
      - Authentication__Microsoft__ClientId=${MICROSOFT_CLIENT_ID:-}
      - Authentication__Microsoft__ClientSecret=${MICROSOFT_CLIENT_SECRET:-}
      - Authentication__Microsoft__TenantId=${MICROSOFT_TENANT_ID:-}
      
      # Google authentication (optional)
      - Authentication__Google__ClientId=${GOOGLE_CLIENT_ID:-}
      - Authentication__Google__ClientSecret=${GOOGLE_CLIENT_SECRET:-}
      
      # ASP.NET Core configuration
      - ASPNETCORE_ENVIRONMENT=Production
      - ASPNETCORE_URLS=http://+:8080
      
      # Logging
      - Logging__LogLevel__Default=Information
      - Logging__LogLevel__Microsoft.AspNetCore=Warning

volumes:
  garageunderground-data:
    driver: local
  garageunderground-keys:
    driver: local
